L.GeometryUtil={computeAngle:function(a,c){return 180*Math.atan2(c.y-a.y,c.x-a.x)/Math.PI+90},getPointPathPixelLength:function(a){if(2>a.length)return 0;for(var c=0,d=a[0],e=1,f=a.length;e<f;e++)c+=d.distanceTo(d=a[e]);return c},getPixelLength:function(a,c){var d=a instanceof L.Polyline?a.getLatLngs():a;if(2>d.length)return 0;for(var e=0,f=c.latLngToLayerPoint(d[0]),g=1,h=d.length;g<h;g++)e+=f.distanceTo(f=c.latLngToLayerPoint(d[g]));return e},projectPatternOnPath:function(a,c,d,e){for(var f=[],g=
0,h=a.length;g<h;g++)f[g]=e.latLngToLayerPoint(a[g]);a=this.projectPatternOnPointPath(f,c,d);g=0;for(h=a.length;g<h;g++)a[g].latLng=e.layerPointToLatLng(a[g].pt);return a},projectPatternOnPointPath:function(a,c,d){var e=[];d*=L.GeometryUtil.getPointPathPixelLength(a);c=L.GeometryUtil.interpolateOnPointPath(a,c);e.push(c);a=a.slice(c.predecessor);a[0]=c.pt;for(c=L.GeometryUtil.getPointPathPixelLength(a,map);d<=c;)c=L.GeometryUtil.interpolateOnPointPath(a,d/c),e.push(c),a=a.slice(c.predecessor),a[0]=
c.pt,c=L.GeometryUtil.getPointPathPixelLength(a,map);return e},interpolateOnPointPath:function(a,c){var d=a.length;if(2>d)return null;if(0>=c)return{pt:a[0],predecessor:0,heading:L.GeometryUtil.computeAngle(a[0],a[1])};if(1<=c)return{pt:a[d-1],predecessor:d-1,heading:L.GeometryUtil.computeAngle(a[d-2],a[d-1])};if(2==d)return{pt:L.GeometryUtil.interpolateBetweenPoints(a[0],a[1],c),predecessor:0,heading:L.GeometryUtil.computeAngle(a[0],a[1])};for(var e=L.GeometryUtil.getPointPathPixelLength(a),f=b=
a[0],g=ratioB=0,h=0,j=1;j<d&&ratioB<c;j++)f=b,g=ratioB,b=a[j],h+=f.distanceTo(b),ratioB=h/e;return{pt:L.GeometryUtil.interpolateBetweenPoints(f,b,(c-g)/(ratioB-g)),predecessor:j-2,heading:L.GeometryUtil.computeAngle(f,b)}},interpolateBetweenPoints:function(a,c,d){return c.x!=a.x?new L.Point(a.x*(1-d)+d*c.x,a.y*(1-d)+d*c.y):new L.Point(a.x,a.y+(c.y-a.y)*d)}};L.Symbol=L.Symbol||{};
L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{weight:3}},initialize:function(a){L.Util.setOptions(this,a)},buildSymbol:function(a,c){var d=this.options;if(1>=d.pixelSize)return new L.Polyline([a.latLng,a.latLng],d.pathOptions);var e=c.project(a.latLng),f=-(a.heading-90)*L.LatLng.DEG_TO_RAD,f=new L.Point(e.x+d.pixelSize*Math.cos(f+Math.PI)/2,e.y+d.pixelSize*Math.sin(f)/2),e=e.add(e.subtract(f));return new L.Polyline([c.unproject(f),c.unproject(e)],d.pathOptions)}});
L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!1,pixelSize:10,headAngle:30,pathOptions:{stroke:!1,weight:2,clickable:!1}},initialize:function(a){L.Util.setOptions(this,a)},buildSymbol:function(a,c){var d=this.options;return d.polygon?new L.Polygon(this._buildArrowPath(a,c),d.pathOptions):new L.Polyline(this._buildArrowPath(a,c),d.pathOptions)},_buildArrowPath:function(a,c){var d=c.project(a.latLng),e=-(a.heading-90)*L.LatLng.DEG_TO_RAD,f=this.options.headAngle*L.LatLng.DEG_TO_RAD,
g=e+f,e=e-f,g=new L.Point(d.x-this.options.pixelSize*Math.cos(g),d.y+this.options.pixelSize*Math.sin(g)),d=new L.Point(d.x-this.options.pixelSize*Math.cos(e),d.y+this.options.pixelSize*Math.sin(e));return[c.unproject(g),a.latLng,c.unproject(d)]}});L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{draggable:!1,clickable:!1}},initialize:function(a){L.Util.setOptions(this,a)},buildSymbol:function(a){return new L.Marker(a.latLng,this.options.markerOptions)}});
L.Symbol.Number=L.Symbol.Marker.extend({isZoomDependant:!1,options:{markerOptions:{draggable:!1,clickable:!1}},initialize:function(a){L.Symbol.Marker.prototype.initialize.call(this);L.Util.setOptions(this,a)},buildSymbol:function(a,c,d,e){a=L.Symbol.Marker.prototype.buildSymbol.call(this,a,d,e);a.setIcon(new L.DivIcon({html:""+d}));return a}});L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(a,c){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,c);this._polyline=a;this._isZoomDependant=!1;this._patterns=[];for(var d,e=0;e<this.options.patterns.length;e++)d=this._parsePatternDef(this.options.patterns[e]),this._patterns.push(d),this._isZoomDependant=this._isZoomDependant||d.isOffsetInPixels||d.isRepeatInPixels||d.symbolFactory.isZoomDependant;this._directionPointCache=[]},_parsePatternDef:function(a){var c=
{cache:[],symbolFactory:a.symbolFactory,isOffsetInPixels:!1,isRepeatInPixels:!1};"string"===typeof a.offset&&-1!=a.offset.indexOf("%")?c.offset=parseFloat(a.offset)/100:(c.offset=parseFloat(a.offset),c.isOffsetInPixels=0<c.offset);"string"===typeof a.repeat&&-1!=a.repeat.indexOf("%")?c.repeat=parseFloat(a.repeat)/100:(c.repeat=parseFloat(a.repeat),c.isRepeatInPixels=0<c.repeat);return c},onAdd:function(a){this._map=a;this._draw();if(this._isZoomDependant)this._map.on("zoomend",this._softRedraw,this)},
onRemove:function(a){this._map.off("zoomend",this._softRedraw,this);L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(a,c){for(var d=[],e=0,f=c.length;e<f;e++)d.push(a.buildSymbol(c[e],this._map,e,f));return d},_getDirectionPoints:function(a){var c=a.cache[this._map.getZoom()];if("undefined"!=typeof c)return c;c=this._polyline instanceof L.Polyline?this._polyline.getLatLngs():this._polyline;if(2>c.length)return[];var d,e;e=null;a.isOffsetInPixels?(e=L.GeometryUtil.getPixelLength(c,
this._map),d=a.offset/e):d=a.offset;a.isRepeatInPixels?(e=null!=e?e:L.GeometryUtil.getPixelLength(c,this._map),e=a.repeat/e):e=a.repeat;c=L.GeometryUtil.projectPatternOnPath(c,d,e,this._map);return a.cache[this._map.getZoom()]=c},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(a){this.clearLayers();if(a)for(a=0;a<this._patterns.length;a++)this._patterns[a].cache=[];this._draw()},_drawPattern:function(a){var c=this._getDirectionPoints(a);a=this._buildSymbols(a.symbolFactory,
c);for(c=0;c<a.length;c++)this.addLayer(a[c])},_draw:function(){for(var a=0;a<this._patterns.length;a++)this._drawPattern(this._patterns[a])}});L.polylineDecorator=function(a,c){return new L.PolylineDecorator(a,c)};
